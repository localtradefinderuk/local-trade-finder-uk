<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Local Trade Finder UK | Find Trusted Local Trades</title>


  <style>
    :root{
      --bg:#0f172a;
      --bg2:#020617;
      --card:#0b1224;
      --stroke:rgba(255,255,255,0.10);
      --text:#e5e7eb;
      --muted:#94a3b8;
      --blue:#2563eb;
      --green:#059669;
      --teal:#5eead4;
      --danger:#fb7185;
      --warn:#fbbf24;
      --radius:14px;
    }

    body{
      font-family: Arial, Helvetica, sans-serif;
      background: var(--bg);
      color: var(--text);
      margin: 0;
    }

/* Make the home content area the positioning parent */
.wrap{ position: relative; }

/* Trader-only promo badge: pinned top-right under header/nav */
.promoSticker.traderOnly{
  position: absolute;
  top: 10px;          /* adjust if needed */
  right: 2px;

  width: 220px;
  height: 220px;

  margin: 0;
  z-index: 3;

  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  text-align:center;

  background: radial-gradient(circle at 30% 30%, #ff2a2a, #9e0000); /* slightly darker */
  color: #fff;
  font-weight: 900;

  clip-path: polygon(
    50% 0%, 60% 8%, 72% 4%, 78% 14%, 90% 10%, 92% 22%,
    100% 30%, 96% 42%, 100% 50%, 96% 58%, 100% 70%, 92% 78%,
    90% 90%, 78% 86%, 72% 96%, 60% 92%, 50% 100%,
    40% 92%, 28% 96%, 22% 86%, 10% 90%, 8% 78%,
    0% 70%, 4% 58%, 0% 50%, 4% 42%, 0% 30%,
    8% 22%, 10% 10%, 22% 14%, 28% 4%, 40% 8%
  );

  box-shadow: 0 16px 35px rgba(0,0,0,.45);
}

/* Create space at the top of the trader tab so the badge doesn't overlap */
#tab-trader{
  padding-top: 70px;
}

/* Mobile: badge becomes normal block again */
@media (max-width: 900px){
  .promoSticker.traderOnly{
    position: static;
    width: 100%;
    height: auto;
    clip-path: none;
    border-radius: 16px;
    padding: 14px;
    margin: 12px 0 18px;
  }
  #tab-trader{ padding-top: 0; }
}


    .headInner{
      max-width:980px; margin:0 auto;
      display:flex; justify-content:space-between; align-items:center;
      gap:12px; flex-wrap:wrap;
    }
    h1{font-size:18px; margin:0}
    .subhead{font-size:12px; color:var(--muted); margin-top:4px;}

.siteHeader{
  background: var(--bg2);
  border-bottom: 1px solid rgba(255,255,255,0.08);
  padding: 16px;
}

.logoWrap{
  display:flex;
  align-items:center;
  gap:14px;
}
.logoWrap img{
  height: 56px;
  width: auto;
  display: block;
}
@media (max-width: 600px){
  .logoWrap img{ height: 44px; }
}

	  
.siteTitle{
  font-size:20px;
  font-weight:900;
}

.mainNav{
  display:flex;
  gap:16px;
}

.navBtn{
  background:none;
  border:none;
  color:var(--muted);
  font-weight:700;
  cursor:pointer;
  font-size:14px;
}

.navBtn:hover{
  color:var(--text);
}

.navBtn.active{
  color:var(--teal);
}

	  
    /* Buttons */
    .btn{
      border:none;
      border-radius:999px;
      padding:10px 14px;
      background:#1e293b;
      color:var(--text);
      cursor:pointer;
      font-weight:800;
      font-size:14px;
    }
    .btn:hover{background:#334155}
    .btn.primary{background: rgba(94,234,212,0.12); border:1px solid rgba(94,234,212,0.55);}
    .btn.blue{background: rgba(37,99,235,0.18); border:1px solid rgba(37,99,235,0.55);}
    .btn.green{background: rgba(5,150,105,0.18); border:1px solid rgba(5,150,105,0.55);}
    .btn.danger{background: rgba(251,113,133,0.15); border:1px solid rgba(251,113,133,0.55);}
    .btn.block{display:block; width:100%; padding:14px; border-radius:12px; font-size:16px;}

    /* Layout */
    main{ padding: 28px 16px; }
.wrap{
  max-width: 1100px;
  margin: 0 auto;
}
.card{
  background: rgba(2,6,23,0.65);
  border: 1px solid var(--stroke);
  border-radius: 16px;
  padding: 18px;
  margin-bottom: 18px;
}
	  /* Trader steps */
.steps{
  margin: 18px 0 22px;
}

.steps h3{
  margin: 0 0 12px;
  font-size: 18px;
}

.stepGrid{
  display: grid;
  gap: 12px;
  grid-template-columns: 1fr;
}

@media (min-width: 820px){
  .stepGrid{
    grid-template-columns: repeat(3, 1fr);
  }
}

.stepCard{
  background: rgba(255,255,255,0.04);
  border: 1px solid rgba(255,255,255,0.10);
  border-radius: 16px;
  padding: 14px;
  box-shadow: 0 10px 24px rgba(0,0,0,0.25);
}

.stepTop{
  display:flex;
  align-items:center;
  gap:10px;
  margin-bottom: 8px;
}

.stepNo{
  width: 34px;
  height: 34px;
  border-radius: 999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight: 900;
  color: #06121f;
  background: rgba(94,234,212,0.95); /* teal badge */
}

.stepTitle{
  font-weight: 900;
  font-size: 14px;
}

.stepCard p{
  margin: 8px 0 0;
  color: var(--muted);
  line-height: 1.4;
  font-size: 13px;
}


    small{color:var(--muted);}

    /* ‚ÄúPages‚Äù */
    .lt-page{display:none;}
    .lt-page.active{display:block;}

    /* Tabs within Home */
    .tabRow{display:flex; gap:10px; flex-wrap:wrap;}
    .tabRow .btn{border-radius:999px;}
    .tabPanel{display:none;}
    .tabPanel.active{display:block;}

    /* Form controls */
    label{display:block; font-size:13px; color:var(--muted); margin:10px 0 6px; font-weight:700;}
    input, select, textarea{
      width:100%;
      box-sizing:border-box;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(15,23,42,0.6);
      color: var(--text);
      padding:12px;
      outline:none;
    }
    textarea{min-height:90px; resize:vertical;}
    .grid2{display:grid; gap:12px; grid-template-columns:1fr;}
    @media(min-width:820px){ .grid2{grid-template-columns:1fr 1fr;} }

    /* My Account + Terms styling */
    .lt-card{
      max-width:980px; margin:0 auto;
      padding:18px;
      background: rgba(255,255,255,0.06);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:16px;
      backdrop-filter: blur(6px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.25);
      color:#ecfeff;
    }
    .lt-title{font-size:20px; font-weight:900; margin:0 0 8px;}
    .lt-sub{font-size:14px; opacity:.85; margin:0 0 12px; line-height:1.45;}
    .lt-grid{display:grid; gap:12px; grid-template-columns:1fr;}
    @media(min-width:820px){ .lt-grid{grid-template-columns:1fr 1fr;} }
    .lt-row{
      display:flex; justify-content:space-between; gap:12px;
      padding:12px; border-radius:14px;
      background: rgba(0,0,0,0.18);
      border:1px solid rgba(255,255,255,0.10);
    }
    .lt-label{opacity:.85; font-size:13px;}
    .lt-value{font-weight:800; font-size:13px; text-align:right;}
    .lt-badges{display:flex; gap:8px; flex-wrap:wrap; margin:0 0 14px;}
    .lt-badge{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.18);
      background: rgba(0,0,0,0.18);
    }
    .lt-badge.ok{border-color: rgba(94,234,212,.55); background: rgba(94,234,212,.10);}
    .lt-badge.warn{border-color: rgba(251,191,36,.65); background: rgba(251,191,36,.12);}
    .lt-actions{display:flex; gap:10px; flex-wrap:wrap; margin-top:14px;}
    .lt-note{font-size:12px; opacity:.75; margin-top:12px; line-height:1.45;}

    hr{border:0; border-top:1px solid rgba(255,255,255,0.10); margin:18px 0;}
    .footerLinks{display:flex; gap:14px; flex-wrap:wrap; font-size:13px; opacity:.9;}
    .footerLinks a{color: var(--text); text-decoration: underline;}
/* Image grid on home page */
.img-grid{
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 14px;
  margin: 28px auto;
  max-width: 1200px;
}

.img-grid img{
  width: 100%;
  height: 170px;
  object-fit: cover;
  border-radius: 12px;
}

/* Responsive */
@media (max-width: 900px){
  .img-grid{
    grid-template-columns: repeat(2, 1fr);
  }
}

@media (max-width: 500px){
  .img-grid{
    grid-template-columns: 1fr;
  }
}

  </style>

  <script>
let lastSearchResults = [];
	  let customerSession = JSON.parse(localStorage.getItem("customerSession") || "null");

    // Top-level page routing (Home / My Account / Terms / Privacy)
    function showLTPage(id){
      document.querySelectorAll('.lt-page').forEach(p => p.classList.remove('active'));
      const el = document.getElementById(id);
      if(!el){ alert("Page not found: " + id); return false; }
      el.classList.add('active');
      window.scrollTo({ top: 0, behavior: 'smooth' });
      return false;
    }

    // Tabs inside Home (Customer / Trader / Admin)
    function setHomeTab(tab){
      document.querySelectorAll('.tabPanel').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('[data-tab]').forEach(b => b.classList.remove('primary'));

      const panel = document.getElementById('tab-' + tab);
      const btn = document.querySelector('[data-tab="'+tab+'"]');

      if(panel) panel.classList.add('active');
      if(btn) btn.classList.add('primary');
		  if(tab === "admin"){
    loadPendingApplications();
 	 }
    }

    async function Search(){
  const type = document.getElementById('custType').value;
  const trade = document.getElementById('custTrade').value;
  const region = document.getElementById('custRegion').value;
  const pc = document.getElementById('custPostcode').value.trim();

  if(!type || !trade || !region){
    alert("Please select Domestic/Commercial, a trade, and a region.");
    return;
  }

  const box = document.getElementById('custResults');
  box.style.display = 'block';

  document.getElementById('custResultsTitle').textContent =
    `Results ‚Äî ${type} ‚Ä¢ ${trade} ‚Ä¢ ${region}${pc ? " ‚Ä¢ " + pc.toUpperCase() : ""}`;

  document.getElementById('custResultsList').innerHTML = `
    <div class="card" style="margin-top:12px;">
      <strong>Searching‚Ä¶</strong><br>
      <small>Please wait.</small>
    </div>
  `;

  try{
    const res = await fetch("/.netlify/functions/search-traders", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ type, trade, region, postcode: pc })
    });

    const text = await res.text();
    if(!res.ok){
      document.getElementById('custResultsList').innerHTML = `
        <div class="card" style="margin-top:12px;">
          <strong>‚ùå Search failed</strong><br>
          <small>${escapeHtml(text)}</small>
        </div>
      `;
      return;
    }

    const payload = JSON.parse(text);
    const results = payload.results || [];
lastSearchResults = results;

    if(results.length === 0){
      document.getElementById('custResultsList').innerHTML = `
        <div class="card" style="margin-top:12px;">
          <strong>No matches yet</strong><br>
          <small>We‚Äôre still onboarding traders for this trade/region.</small>
        </div>
      `;
      return;
    }

    document.getElementById('custResultsList').innerHTML = results.map((r, i) => `
      <div class="card" style="margin-top:12px;">
        <strong>${escapeHtml(r.name)}</strong><br>
<small>${escapeHtml(r.trade)}</small><br>
${formatRating(r)}<br>
<small>
  Base: ${escapeHtml(r.base_town || "‚Äî")} ‚Ä¢ ${escapeHtml(r.base_postcode || "‚Äî")}
</small><br>

        <small>
          Covers: ${(r.areas_covered && r.areas_covered.length) ? escapeHtml(r.areas_covered.join(", ")) : "‚Äî"}
        </small>
        ${r.about ? `<hr><small>${escapeHtml(r.about)}</small>` : ""}
		<div style="margin-top:12px; display:flex; gap:10px; flex-wrap:wrap;">
  <button class="btn primary" onclick='openProfile(${JSON.stringify(r).replaceAll("'", "\\'")})'>
    View profile
  </button>
</div>

      </div>
    `).join("");

  }catch(e){
    document.getElementById('custResultsList').innerHTML = `
      <div class="card" style="margin-top:12px;">
        <strong>‚ùå Network error</strong><br>
        <small>${escapeHtml(e.message)}</small>
      </div>
    `;
  }
}
function fileToBase64(file){
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => {
      const result = String(reader.result || "");
      const base64 = result.split(",")[1] || "";
      resolve(base64);
    };
    reader.onerror = reject;
    reader.readAsDataURL(file);
  });
}

async function traderSubmit(){
  const name = document.getElementById('trName').value.trim();
  const email = document.getElementById('trEmail').value.trim();
  const phone = document.getElementById('trPhone').value.trim();
  const trade = document.getElementById('trTrade').value;
  const offering = document.getElementById('trOffering').value;
  const about = document.getElementById('trAbout') ? document.getElementById('trAbout').value.trim() : "";
  const agree = document.getElementById('trAgree').checked;
  const password = document.getElementById('trPassword').value;
  const base_town = document.getElementById('trBaseTown').value.trim();
  const base_postcode_raw = document.getElementById('trBasePostcode').value.trim();
  const areas_covered = Array.from(document.querySelectorAll('input[name="trAreasCovered"]:checked'))
    .map(cb => cb.value);

  const base_postcode = base_postcode_raw.toUpperCase().replace(/\s+/g, " ").trim();
  
  if(!name || !email || !password || !phone || !trade || !offering || !base_town || !base_postcode){
    alert("Please complete all required fields (including base town and postcode).");
    return;
  }

  if(areas_covered.length === 0){
    alert("Please select at least one area covered.");
    return;
  }

  if(!agree){
    alert("Please agree to the Trader Terms.");
    return;
  }

  const out = document.getElementById('trConfirmation');
  out.style.display = 'block';
  out.innerHTML = `<div class="card">Submitting‚Ä¶</div>`;
let photo_url = null;

const photoEl = document.getElementById("trPhoto");
const file = photoEl && photoEl.files && photoEl.files[0] ? photoEl.files[0] : null;

if (file) {
  out.innerHTML = `<div class="card">Uploading photo‚Ä¶</div>`;

  const base64 = await fileToBase64(file);

  const upRes = await fetch("/.netlify/functions/upload-photo", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      mime: file.type,
      base64
    })
  });

  if (!upRes.ok) {
    out.innerHTML = `<div class="card">‚ùå Photo upload failed: ${escapeHtml(await upRes.text())}</div>`;
    return;
  }

  const upJson = await upRes.json();
  photo_url = upJson.photo_url;
}

  try{
    const res = await fetch("/.netlify/functions/submit-application", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
  name, email, password, phone, trade, offering, about,
  base_town, base_postcode, areas_covered, photo_url
})

    });

    if(!res.ok){
      const errText = await res.text();
      out.innerHTML = `<div class="card">‚ùå Submission failed: ${errText}</div>`;
      return;
    }

    out.innerHTML = `
      <div class="card" style="background:rgba(0,0,0,0.18); border:1px solid rgba(255,255,255,0.10);">
        <strong>‚úÖ Submitted for approval</strong><br>
        <small>We‚Äôve received your application. We‚Äôll review it shortly.</small>
      </div>
    `;
// Clear form fields
document.getElementById('trName').value = "";
document.getElementById('trEmail').value = "";
document.getElementById('trPassword').value = "";


const phoneEl = document.getElementById('trPhone');
if (phoneEl) phoneEl.value = "";

document.getElementById('trTrade').value = "";
document.getElementById('trOffering').value = "";

const aboutEl = document.getElementById('trAbout');
if (aboutEl) aboutEl.value = "";

document.getElementById('trAgree').checked = false;

	  
	  
  }catch(e){
    out.innerHTML = `<div class="card">‚ùå Network error: ${e.message}</div>`;
  }
}
function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function postcodePrefix(pc){
  const s = String(pc || "").trim().toUpperCase();
  return s ? s.split(/\s+/)[0] : "‚Äî";
}
function formatRating(r){
  const avg = Number(r?.avg_rating || 0);
  const cnt = Number(r?.review_count || 0);

  if(cnt <= 0){
    return `<small style="color:var(--muted);">No reviews yet</small>`;
  }

  return `<small>‚≠ê ${avg.toFixed(1)} (${cnt})</small>`;
}

	  function openProfile(trader){
  // trader is an object from search results
  const modal = document.getElementById("profileModal");
  const content = document.getElementById("profileContent");
  if(!modal || !content) return;

  const imgHtml = trader.photo_url
    ? `<img src="${escapeHtml(trader.photo_url)}" alt="Profile photo" style="width:92px;height:92px;border-radius:16px;object-fit:cover;border:1px solid rgba(255,255,255,0.12);">`
    : `<div style="width:92px;height:92px;border-radius:16px;background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.12);display:flex;align-items:center;justify-content:center;font-weight:900;color:rgba(255,255,255,0.5);">No photo</div>`;

  const areas = (trader.areas_covered && trader.areas_covered.length) ? trader.areas_covered.join(", ") : "‚Äî";

  const emailBtn = trader.email
    ? `<a class="btn blue" href="mailto:${encodeURIComponent(trader.email)}">Email trader</a>`
    : "";

  const phoneBtn = trader.phone
    ? `<a class="btn green" href="tel:${encodeURIComponent(trader.phone)}">Call trader</a>`
    : "";

	const readReviewsBtn = `
  <button class="btn primary" onclick="openReviews('${trader.id}', '${escapeHtml(trader.name)}')">
    ‚≠ê Read reviews
  </button>
`;

const writeReviewBtn = `
  <button class="btn blue" onclick="openWriteReview('${trader.id}', '${escapeHtml(trader.name)}')">
    ‚úçÔ∏è Write review
  </button>
`;
	  
  content.innerHTML = `
    <div style="display:flex; gap:14px; align-items:flex-start;">
      ${imgHtml}
     <div style="color:var(--muted); font-weight:700; margin-bottom:6px;">
  ${escapeHtml(trader.trade || "‚Äî")}
</div>
<div style="margin-bottom:10px;">
  ${formatRating(trader)}
</div>


      <div style="display:flex; gap:14px; margin:14px 0 6px;">

  <!-- LEFT COLUMN -->
  <div style="display:flex; flex-direction:column; gap:10px;">
    ${emailBtn}
    <button class="btn primary"
      onclick='openReviews(${JSON.stringify(trader).replaceAll("'", "\\'")})'>
      ‚≠ê Read reviews
    </button>
  </div>

  <!-- RIGHT COLUMN -->
  <div style="display:flex; flex-direction:column; gap:10px;">
    ${phoneBtn}
    <button class="btn blue"
      onclick='openWriteReview("${trader.id}", "${escapeHtml(trader.name)}")'>
      ‚úçÔ∏è Write review
    </button>
  </div>

</div>


      </div>
    </div>
${trader.phone ? `<div style="color:var(--text); font-weight:900; margin-top:6px;">
  Phone: ${escapeHtml(trader.phone)}
</div>` : ""}

    <hr>

    <div class="lt-grid" style="margin-top:8px;">
      <div class="lt-row"><div class="lt-label">Base</div><div class="lt-value">${escapeHtml(trader.base_town || "‚Äî")} ‚Ä¢ ${escapeHtml(postcodePrefix(trader.base_postcode))}
  </div>
</div>
      <div class="lt-row"><div class="lt-label">Areas covered</div><div class="lt-value">${escapeHtml(areas)}</div></div>
    </div>

    ${trader.about ? `<hr><div style="color:var(--text); line-height:1.5;"><strong>About</strong><br><small>${escapeHtml(trader.about)}</small></div>` : ""}
  `;

  modal.style.display = "block";
}

function closeProfile(){
  const modal = document.getElementById("profileModal");
  if(modal) modal.style.display = "none";
}
async function openReviews(trader){
  const modal = document.getElementById("reviewsModal");
  const content = document.getElementById("reviewsContent");
  if(!modal || !content) return;

  modal.style.display = "block";
  content.innerHTML = `
    <h2 style="margin:0 0 6px;">Reviews ‚Äî ${escapeHtml(trader.name || "Trader")}</h2>
    <div style="margin-bottom:12px;">${formatRating(trader)}</div>
    <div class="card" style="margin-top:12px;">
      <strong>Loading reviews‚Ä¶</strong><br>
      <small>Please wait.</small>
    </div>
  `;

  try{
    const res = await fetch("/.netlify/functions/get-reviews", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ trader_id: trader.id })
    });

    const text = await res.text();
    if(!res.ok){
      content.innerHTML += `
        <div class="card" style="margin-top:12px;">
          <strong>‚ùå Failed to load reviews</strong><br>
          <small>${escapeHtml(text)}</small>
        </div>
      `;
      return;
    }

    const payload = JSON.parse(text);
    const reviews = payload.reviews || [];

    if(!reviews.length){
      content.innerHTML += `
        <div class="card" style="margin-top:12px;">
          <strong>No reviews yet</strong><br>
          <small>Be the first to leave feedback.</small>
        </div>
      `;
      return;
    }

    content.innerHTML += reviews.map(r => `
      <div class="card" style="margin-top:12px;">
        <strong>${"‚≠ê".repeat(Number(r.rating || 0))}</strong>
        <small style="color:var(--muted); margin-left:8px;">
          ${new Date(r.created_at).toLocaleDateString()}
        </small>
        ${r.title ? `<div style="margin-top:6px; font-weight:900;">${escapeHtml(r.title)}</div>` : ""}
        <div style="margin-top:6px; color:var(--text); line-height:1.5;">
          <small>${escapeHtml(r.body || "")}</small>
        </div>
      </div>
    `).join("");

  }catch(e){
    content.innerHTML += `
      <div class="card" style="margin-top:12px;">
        <strong>‚ùå Network error</strong><br>
        <small>${escapeHtml(e.message)}</small>
      </div>
    `;
  }
}

function closeReviews(){
  const modal = document.getElementById("reviewsModal");
  if(modal) modal.style.display = "none";
}
function isCustomerLoggedIn(){
  customerSession = JSON.parse(localStorage.getItem("customerSession") || "null");
  return !!customerSession?.access_token;
}

async function openWriteReview(traderId, traderName){
  const modal = document.getElementById("reviewsModal");
  const content = document.getElementById("reviewsContent");
  if(!modal || !content) return;

  modal.style.display = "block";

  // Store where we were so after magic link we can resume
  localStorage.setItem("pendingReviewTraderId", traderId);
  localStorage.setItem("pendingReviewTraderName", traderName);

  if(!isCustomerLoggedIn()){
    content.innerHTML = `
      <h2 style="margin:0 0 6px;">Write a review</h2>
      <small style="color:var(--muted);">You‚Äôll need to verify your email (magic link). No password.</small>

      <div class="card" style="margin-top:12px;">
        <label>Your email</label>
        <input id="custReviewEmail" type="email" placeholder="you@example.com" />
        <button class="btn primary" style="margin-top:12px;" onclick="sendCustomerMagicLink()">
          Send magic link
        </button>
        <div id="custReviewEmailMsg" style="margin-top:10px; color:var(--muted);"></div>
      </div>
    `;
    return;
  }
async function sendCustomerMagicLink(){
  const emailInput = document.getElementById("custReviewEmail");
  const msg = document.getElementById("custReviewEmailMsg");

  if(!emailInput || !msg) return;

  const email = emailInput.value.trim();
  if(!email){
    msg.textContent = "Please enter your email.";
    return;
  }

  msg.textContent = "Sending magic link‚Ä¶";

  const res = await fetch("/.netlify/functions/customer-magic-link", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email })
  });

  if(!res.ok){
    msg.textContent = "Failed to send magic link. Try again.";
    return;
  }

  msg.textContent = "‚úÖ Magic link sent. Check your email.";
}

  // Logged in ‚Üí show form
  content.innerHTML = `
    <h2 style="margin:0 0 6px;">Write a review ‚Äî ${escapeHtml(traderName)}</h2>
    <small style="color:var(--muted);">Signed in. Your review will be public.</small>

    <div class="card" style="margin-top:12px;">
      <label>Star rating</label>
      <select id="revRating">
        <option value="5">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ (5)</option>
        <option value="4">‚òÖ‚òÖ‚òÖ‚òÖ‚òÜ (4)</option>
        <option value="3">‚òÖ‚òÖ‚òÖ‚òÜ‚òÜ (3)</option>
        <option value="2">‚òÖ‚òÖ‚òÜ‚òÜ‚òÜ (2)</option>
        <option value="1">‚òÖ‚òÜ‚òÜ‚òÜ‚òÜ (1)</option>
      </select>

      <label style="margin-top:12px;">Title (optional)</label>
      <input id="revTitle" maxlength="120" placeholder="e.g. Great service" />

      <label style="margin-top:12px;">Review</label>
      <textarea id="revBody" maxlength="1000" placeholder="Tell others what the trader was like‚Ä¶"></textarea>
      <small style="color:var(--muted);">Max 1000 characters</small>

      <button class="btn green" style="margin-top:12px;" onclick="submitReview('${traderId}', '${escapeHtml(traderName)}')">
        Submit review
      </button>

      <button class="btn" style="margin-top:10px;" onclick="customerLogout()">
        Log out
      </button>

      <div id="revMsg" style="margin-top:10px; color:var(--muted);"></div>
    </div>
  `;
}

async function sendCustomerMagicLink(){
  const email = document.getElementById("custReviewEmail")?.value?.trim();
  const msg = document.getElementById("custReviewEmailMsg");
  if(!email){ msg.textContent = "Please enter your email."; return; }

  msg.textContent = "Sending magic link‚Ä¶";

  // Redirect back to homepage; tokens come back in URL hash
  const redirectTo = `${window.location.origin}/#type=customer_review`;

  const res = await fetch("/.netlify/functions/customer-magiclink", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, redirectTo })
  });

  if(!res.ok){
    msg.textContent = "Failed to send link. Please try again.";
    return;
  }

  msg.textContent = "‚úÖ Check your email and click the link to return here.";
}

function customerLogout(){
  localStorage.removeItem("customerSession");
  customerSession = null;
  alert("Logged out.");
}

async function loadPendingApplications(){
  const box = document.getElementById("adminApps");
  if (!box) return;

  box.innerHTML = "Loading pending applications‚Ä¶";

  // Simple admin token prompt (store for session)
  const token = sessionStorage.getItem("adminToken") || prompt("Admin token:");
  if (!token) { box.innerHTML = "No admin token provided."; return; }
  sessionStorage.setItem("adminToken", token);

  const res = await fetch("/.netlify/functions/list-applications", {
    method: "GET",
    headers: { "x-admin-token": token }
  });

  if (!res.ok){
    box.innerHTML = `‚ùå Failed to load: ${escapeHtml(await res.text())}`;
    return;
  }

  const apps = await res.json();
  if (!apps.length){
    box.innerHTML = "No pending applications.";
    return;
  }

 box.innerHTML = apps.map(a => `
  ${a.photo_url ? `
  <div style="display:flex; gap:12px; align-items:center; margin-top:8px;">
    <img src="${escapeHtml(a.photo_url)}"
         alt="Trader photo"
         style="width:72px;height:72px;border-radius:14px;object-fit:cover;border:1px solid rgba(255,255,255,0.14);" />
    <div>
      <small style="color:var(--muted);">Profile photo uploaded</small>
    </div>
  </div>
` : `
  <small style="color:var(--muted);">No profile photo uploaded</small>
`}


    <strong>${escapeHtml(a.name)}</strong> ‚Äî <small>${escapeHtml(a.status)}</small><br>

    <small>
      ${escapeHtml(a.trade)} ‚Ä¢ ${(a.areas_covered && a.areas_covered.length) ? escapeHtml(a.areas_covered.join(", ")) : "‚Äî"} ‚Ä¢ ${escapeHtml(a.offering)}
    </small><br>

    <small>
      Base: ${escapeHtml(a.base_town || "‚Äî")} ‚Ä¢ ${escapeHtml(a.base_postcode || "‚Äî")}
    </small><br>

    <small>${escapeHtml(a.email)} ‚Ä¢ ${new Date(a.created_at).toLocaleString()}</small>

    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
      <button class="btn green" onclick="approveApp('${escapeHtml(a.id)}')">‚úÖ Approve</button>
      <button class="btn danger" onclick="declineApp('${escapeHtml(a.id)}')">‚ùå Decline</button>
    </div>
  </div>
`).join("");

}
async function traderLogin(){
  const email = document.getElementById("loginEmail").value.trim();
  const password = document.getElementById("loginPassword").value;
  const msg = document.getElementById("loginMsg");

  msg.style.color = "var(--muted)";
  msg.textContent = "Logging in‚Ä¶";

  try{
    const res = await fetch("/.netlify/functions/trader-login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ email, password })
    });

    const text = await res.text();

    if(!res.ok){
      msg.style.color = "#fb7185";
      msg.textContent = "Login failed ‚Äî check your email and password.";
      return;
    }

    const session = JSON.parse(text);

    // Save session locally (simple MVP)
    localStorage.setItem("traderSession", JSON.stringify(session));

    msg.style.color = "#5eead4";
    msg.textContent = "‚úÖ Logged in.";

    // Show account content
    document.getElementById("loginBox").style.display = "none";
    document.getElementById("accountBox").style.display = "block";

	  await loadMyApplication();

  }catch(e){
    msg.style.color = "#fb7185";
    msg.textContent = "Network error ‚Äî please try again.";
  }
}

async function loadMyApplication(){
  const session = JSON.parse(localStorage.getItem("traderSession") || "null");
  if(!session?.access_token) return;

  const res = await fetch("/.netlify/functions/get-my-application", {
    headers: { "Authorization": `Bearer ${session.access_token}` }
  });

  if(!res.ok) return;

  const apps = await res.json();
  const app = apps?.[0];
  if(!app) return;

  const status = String(app.status || "pending").toLowerCase();

  const badges = document.querySelector("#accountBox .lt-badges");
  if(!badges) return;

  let label = "Pending approval";
  let badgeClass = "warn";

  if(status === "approved"){
    label = "Approved";
    badgeClass = "ok";
  }
  if(status === "declined"){
    label = "Declined";
    badgeClass = "danger";
  }

  badges.innerHTML = `
    <span class="lt-badge ${badgeClass}">${label}</span>
  `;
}

async function approveApp(id){
  const token = sessionStorage.getItem("adminToken") || prompt("Admin token:");
  if (!token) return;
  sessionStorage.setItem("adminToken", token);

  const feedbackEl = document.getElementById("adminFeedback");
  const admin_notes = feedbackEl ? feedbackEl.value.trim() : "";

  const res = await fetch("/.netlify/functions/approve-application", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-admin-token": token
    },
    body: JSON.stringify({ id, admin_notes })
  });

  if(!res.ok){
    alert("Approve failed: " + await res.text());
    return;
  }

  // refresh pending list
  await loadPendingApplications();
}
async function declineApp(id){
  const token = sessionStorage.getItem("adminToken") || prompt("Admin token:");
  if (!token) return;
  sessionStorage.setItem("adminToken", token);

  const feedbackEl = document.getElementById("adminFeedback");
  const admin_notes = feedbackEl ? feedbackEl.value.trim() : "";

  if(!admin_notes){
    const ok = confirm("No feedback entered. Decline anyway?");
    if(!ok) return;
  }

  const res = await fetch("/.netlify/functions/decline-application", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-admin-token": token
    },
    body: JSON.stringify({ id, admin_notes })
  });

if(!res.ok){
  const t = await res.text();
  console.log("Decline failed response:", t);
  alert("Decline failed ‚Äî check Console (F12) for details.");
  return;
}


  // Clear feedback after action (optional)
  if (feedbackEl) feedbackEl.value = "";

  await loadPendingApplications();
}
async function searchApprovedTraders(){
  const box = document.getElementById("adminApproved");
  const q = document.getElementById("adminSearchQ").value.trim();
  box.innerHTML = "Searching‚Ä¶";

  const token = sessionStorage.getItem("adminToken") || prompt("Admin token:");
  if (!token) { box.innerHTML = "No admin token provided."; return; }
  sessionStorage.setItem("adminToken", token);

  const url = "/.netlify/functions/search-approved-traders" + (q ? `?q=${encodeURIComponent(q)}` : "");
  const res = await fetch(url, { headers: { "x-admin-token": token } });

  if(!res.ok){
    box.innerHTML = `‚ùå Failed: ${escapeHtml(await res.text())}`;
    return;
  }

  const rows = await res.json();
  if(!rows.length){
    box.innerHTML = "No approved traders found.";
    return;
  }

  box.innerHTML = rows.map(t => `
    <div class="card" style="margin-top:10px;">
      <strong>${escapeHtml(t.name)}</strong><br>
      <small>${escapeHtml(t.trade)} ‚Ä¢ ${escapeHtml(t.email)}</small><br>
      <small>Base: ${escapeHtml(t.base_town || "-")} ‚Ä¢ ${escapeHtml(t.base_postcode || "-")}</small><br>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px;">
        <button class="btn danger" onclick="banTrader('${escapeHtml(t.id)}')">‚õî Ban</button>
      </div>
    </div>
  `).join("");
}

async function banTrader(id){
  const token = sessionStorage.getItem("adminToken") || prompt("Admin token:");
  if (!token) return;
  sessionStorage.setItem("adminToken", token);

  const reason = prompt("Reason for ban (saved to admin notes):") || "";

  const res = await fetch("/.netlify/functions/ban-trader", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "x-admin-token": token
    },
    body: JSON.stringify({ id, admin_notes: reason })
  });

  if(!res.ok){
    alert("Ban failed: " + await res.text());
    return;
  }

  // refresh approved search list
  await searchApprovedTraders();
}

function parseHashParams(){
  const hash = window.location.hash.substring(1);
  const params = new URLSearchParams(hash);
  return params;
}

window.addEventListener('load', () => {
  // Capture Supabase magic-link tokens from URL hash
  const hp = parseHashParams();
  if(hp.access_token){
    const sess = {
      access_token: hp.access_token,
      refresh_token: hp.refresh_token
    };
    localStorage.setItem("customerSession", JSON.stringify(sess));
    customerSession = sess;

    // Clean the URL hash
    history.replaceState(null, "", window.location.pathname);
  }

  showLTPage('lt-home');
  setHomeTab('customer');

  // If we just returned from magic link, reopen write review
  const pendingId = localStorage.getItem("pendingReviewTraderId");
  const pendingName = localStorage.getItem("pendingReviewTraderName");
  if(pendingId && pendingName && hp.type === "customer_review"){
    openWriteReview(pendingId, pendingName);
  }
});


  const params = parseHashParams();

  if (params.get("access_token")) {

    customerSession = {
      access_token: params.get("access_token"),
      refresh_token: params.get("refresh_token"),
      expires_in: params.get("expires_in"),
      token_type: params.get("token_type")
    };

    localStorage.setItem("customerSession", JSON.stringify(customerSession));

    window.location.hash = "";

    alert("‚úÖ Logged in successfully. You can now leave a review.");
  }
});

  </script>
</head>

<body>
  
  <!-- Header -->
 <header class="siteHeader">
  <div class="headInner">

    <div class="logoWrap">
      <img src="images/logo-icon-v2.png" alt="Local Trade Finder UK logo">
      <div>
        <div class="siteTitle">Local Trade Finder UK</div>
        <div class="subhead">
          Connecting customers with trusted local trades across the North West & Yorkshire
        </div>
      </div>
    </div>

    <nav class="mainNav">
      <button class="navBtn active" onclick="return showLTPage('lt-home')">Home</button>
      <button class="navBtn" onclick="return showLTPage('lt-myaccount')">Trader Login</button>
    </nav>

  </div>
</header>



  <!-- HOME -->
  <div id="lt-home" class="lt-page active">
    <main>
      <div class="wrap">

        <div class="card">
          <div class="tabRow">
            <button class="btn primary" data-tab="customer" onclick="setHomeTab('customer')">Customer</button>
            <button class="btn" data-tab="trader" onclick="setHomeTab('trader')">Trader</button>
            <button class="btn" data-tab="admin" onclick="setHomeTab('admin')">Admin</button>
          </div>
        </div>




        <!-- CUSTOMER -->
        <div id="tab-customer" class="tabPanel active">
			<div class="img-grid">
  <img src="images/gang of tradesmen.jpg" alt="Local electrician at work">
  <img src="images/plumber 1.jpg" alt="Plumber working in a home">
  <img src="images/builder.jpg" alt="Builder on site">
  <img src="images/cleaners.jpg" alt="Domestic Cleaner">
</div>
          <div class="card">
            <h2 style="margin-top:0;">Find a trader</h2>
            <p style="color:var(--muted); margin-top:6px;">
              Search for trusted local trades in your area. 
              Select your service type, choose a trade, and enter your postcode to get started. </small>
            </p>

<div class="grid2">
  <div>
    <label>Domestic or Commercial</label>
    <select id="custType">
      <option value="">Select‚Ä¶</option>
      <option>Domestic</option>
      <option>Commercial</option>
    </select>
  </div>

  <div>
    <label>Trade</label>
    <select id="custTrade">
      <option value="">Select‚Ä¶</option>
      <option>Handyman</option>
      <option>Electrician</option>
      <option>Plumber</option>
      <option>Joiner</option>
      <option>Painter & Decorator</option>
      <option>Plasterer</option>
      <option>Builder</option>
      <option>Roofing</option>
      <option>PVC Window & Door Fitting</option>
      <option>Kitchen Fitting</option>
      <option>Bathroom Fitting</option>
      <option>Cleaner</option>
    </select>
  </div>
</div>

<div class="grid2">
  <div>
    <label>Region</label>
    <select id="custRegion">
      <option value="">Select‚Ä¶</option>
      <option>Greater Manchester</option>
      <option>Lancashire</option>
      <option>Merseyside</option>
      <option>Cheshire</option>
      <option>Yorkshire</option>
    </select>
  </div>

  <div>
    <label>Postcode</label>
    <input id="custPostcode" placeholder="e.g. BD21 1AA" />
  </div>
</div>


           <button class="btn block blue" style="margin-top:14px;" onclick="Search()">üîé Search</button>

            <div id="custResults" style="display:none; margin-top:12px;">
              <div style="font-weight:900; margin-bottom:6px;" id="custResultsTitle"></div>
              <div id="custResultsList"></div>
            </div>
          </div>
        </div>

        <!-- TRADER -->
        <div id="tab-trader" class="tabPanel">

   <div class="promoSticker traderOnly">
	  <div style="font-size:10px; font-weight:900;">SIGN UP BY</div>
      <div style="font-size:10px; font-weight:900;">31 MARCH 2026</div>

      <div style="font-size:40px; line-height:1; margin-top:10px;">50%</div>
      <div style="font-size:24px; color:#ffd400; margin-top:2px;">OFF</div>

      <div style="font-size:14px; margin-top:10px;">FIRST 3 MONTHS</div>
      <div style="font-size:12px; margin-top:8px; font-weight:900;">
        CODE: <span style="color:#ffd400;">EARLY50</span>
      </div>
    </div>
			
          <div class="card">
            <h2 style="margin-top:0;">Join as a trader</h2>
            <p style="color:var(--muted); margin-top:6px;">
              List your business and receive direct enquiries from local customers.
              No lead bidding. No commission per job. Just a simple monthly listing.

            </p>

<!-- Sign up steps -->
<div class="steps">
  <h3>Sign up in 3 easy steps</h3>

  <div class="stepGrid">
    <div class="stepCard">
      <div class="stepTop">
        <div class="stepNo">1</div>
        <div class="stepTitle">Add your details</div>
      </div>
      <p>
        Tell us your trade, where you work, and what services you offer. This is shown to customers once approved.
      </p>
    </div>

    <div class="stepCard">
      <div class="stepTop">
        <div class="stepNo">2</div>
        <div class="stepTitle">Choose a plan</div>
      </div>
      <p>
        Pick the plan that fits your business and enter your payment details. No charge is taken before launch.
      </p>
    </div>

    <div class="stepCard">
      <div class="stepTop">
        <div class="stepNo">3</div>
        <div class="stepTitle">We review & publish</div>
      </div>
      <p>
        We‚Äôll review your application and make your listing live for customers to discover at launch.
      </p>
    </div>
  </div>
</div>


         <div class="grid2">
  <div>
    <label>Business / trading name</label>
    <input id="trName" placeholder="e.g. Dave‚Äôs Handyman Services" />
  </div>

  <div>
    <label>Trade</label>
    <select id="trTrade">
      <option value="">Select‚Ä¶</option>
      <option>Handyman</option>
      <option>Electrician</option>
      <option>Plumber</option>
      <option>Joiner</option>
      <option>Painter & Decorator</option>
      <option>Plasterer</option>
      <option>Builder</option>
      <option>Roofing</option>
      <option>PVC Window & Door Fitting</option>
      <option>Kitchen Fitting</option>
      <option>Bathroom Fitting</option>
      <option>Cleaner</option>
    </select>
  </div>
</div>

<label>
  About you (shown to customers)
  <textarea
    id="trAbout"
    rows="5"
    maxlength="500"
    placeholder="Tell customers about your experience, what you specialise in, where you cover, and what makes you different‚Ä¶"></textarea>
</label>
<small class="hint">Maximum 500 characters</small>

<label>
  Profile photo (optional)
  <input id="trPhoto" type="file" accept="image/*">
</label>
<small class="hint">JPG/PNG. We‚Äôll crop it to a square.</small>
  

           <div class="grid2">
  <div>
    <label>Base town</label>
    <input id="trBaseTown" placeholder="e.g. Keighley" />
  </div>

  <div>
    <label>Base postcode</label>
    <input id="trBasePostcode" placeholder="e.g. BD21 1AA" />
  </div>
</div>
<label>Phone number (shown to customers)</label>
<input id="trPhone" type="tel" placeholder="e.g. 07xxx xxx xxx" />

<label>Areas covered (select all that apply)</label>
<div style="display:grid; gap:8px; grid-template-columns:1fr; margin-bottom:8px;">
  <label style="margin:0;">
    <input type="checkbox" name="trAreasCovered" value="Greater Manchester" style="width:auto; margin-right:8px;">
    Greater Manchester
  </label>

  <label style="margin:0;">
    <input type="checkbox" name="trAreasCovered" value="Lancashire" style="width:auto; margin-right:8px;">
    Lancashire
  </label>

  <label style="margin:0;">
    <input type="checkbox" name="trAreasCovered" value="Merseyside" style="width:auto; margin-right:8px;">
    Merseyside
  </label>

  <label style="margin:0;">
    <input type="checkbox" name="trAreasCovered" value="Cheshire" style="width:auto; margin-right:8px;">
    Cheshire
  </label>

  <label style="margin:0;">
    <input type="checkbox" name="trAreasCovered" value="Yorkshire" style="width:auto; margin-right:8px;">
    Yorkshire
  </label>

              <div>
                <label>Offering</label>
                <select id="trOffering">
                  <option value="">Select‚Ä¶</option>
                  <option>Domestic ‚Äî ¬£29 / month</option>
                  <option>Commercial ‚Äî ¬£29 / month</option>
                  <option>Both ‚Äî ¬£39 / month</option>
                </select>
              </div>
            </div>

            <label>Promo code (optional)</label>
            <input id="trPromo" placeholder="EARLY50" />
            <small>EARLY50 gives 50% off your first 3 months (applies at launch).</small>

            <div class="card" style="margin-top:12px;">
              <strong>Payment details </strong><br>
              <small>
                Traders enter payment details during registration (Card / Apple Pay / Google Pay),
                but <strong>¬£0 is taken until 1 March 2026</strong>.
              </small>
              <div class="grid2" style="margin-top:10px;">
                <div>
                  <label>Payment method </label>
                  <select>
                    <option>Card</option>
                    <option>Apple Pay (supported devices)</option>
                    <option>Google Pay (supported devices)</option>
                  </select>
                </div>
                <div>
                  <label>Email (used for approval and billing)</label>
		  <input id="trEmail" type="email" placeholder="you@example.com" required>
					<label>Password (for your Trader login)</label>
<input id="trPassword" type="password" minlength="8" placeholder="Minimum 8 characters" required>
<small>Used to access your Trader account later. You can change this after launch.</small>


                </div>
              </div>
            </div>

<hr style="margin:28px 0; opacity:.2;">

<h3 style="margin-bottom:6px;">Choose your plan</h3>
<p style="color:var(--muted); margin-top:0;">
  Free until <strong>1 March 2026</strong> (launch day). Card details required now. No charge will be taken before launch.
</p>

<div style="display:flex; flex-direction:column; gap:14px; margin-top:18px;">


  <!-- ¬£29 plan -->
  <a
    href="https://buy.stripe.com/00wcN4fQM5pXdb67owdby01"
    target="_blank"
    class="btn"
    style="text-align:center;"
  >
    Join ‚Äì Single Category (¬£29 / month)
  </a>

  <!-- ¬£39 plan -->
  <a
    href="https://buy.stripe.com/14A6oG484aKhfjecIQdby00"
    target="_blank"
    class="btn primary"
    style="text-align:center;"
  >
    Join ‚Äì Domestic & Commercial (¬£39 / month)
  </a>

              </div>


            <label style="margin-top:12px;">
              <input id="trAgree" type="checkbox" style="width:auto; margin-right:8px;">
              I agree to the <a href="#" onclick="return showLTPage('lt-terms-traders')" style="color:#e5e7eb; text-decoration:underline;">Trader Terms</a>
            </label>

            <button class="btn block primary" onclick="traderSubmit()">‚úÖ Submit for approval</button>

            <div id="trConfirmation" style="display:none; margin-top:12px;"></div>
          </div>
        </div>

<!-- ADMIN -->
<div id="tab-admin" class="tabPanel">
  <div class="card">
    <h2 style="margin-top:0;">Admin panel</h2>
    <p style="color:var(--muted); margin-top:6px;">
      Review and manage trader applications.
      Approve listings once verified and ready for publication.
    </p>

    <!-- list of pending apps (cards get injected here) -->
    <div id="adminApps" class="card" style="margin-top:12px;"></div>

    <!-- feedback box (used when declining) -->
    <label style="margin-top:14px;">Feedback to trader (used when declining)</label>
    <textarea id="adminFeedback"
      placeholder="e.g. Please add proof of insurance, confirm domestic/commercial offering, and service postcodes."></textarea>

    <small>This message will be saved as admin notes when you decline an application.</small>
  </div>
	<hr style="margin-top:18px;">

<h3 style="margin-top:0;">Search approved traders</h3>

<div class="grid2">
  <div>
    <label>Search by name / email / trade</label>
    <input id="adminSearchQ" placeholder="e.g. lee, plumber, gmail" />
  </div>
  <div style="display:flex; align-items:flex-end;">
    <button class="btn blue" onclick="searchApprovedTraders()">Search</button>
  </div>
</div>

<div id="adminApproved" class="card" style="margin-top:12px;"></div>

</div>


        

        <hr>
       <div class="footerLinks">
  <a href="#" onclick="return showLTPage('lt-terms-customers')">Customer Terms</a>
  <a href="#" onclick="return showLTPage('lt-terms-traders')">Trader Terms</a>
  <a href="#" onclick="return showLTPage('lt-privacy')">Privacy Policy</a>
  <a href="mailto:localtradefinderuk@gmail.com">Contact support</a>
</div>

        <small style="display:block; margin-top:10px;">
          ¬© Local Trade Finder ‚Ä¢ North West & Yorkshire ‚Ä¢ Prices in GBP (¬£)
        </small>

      </div>
    </main>
  </div>

  <!-- MY ACCOUNT -->
  <div id="lt-myaccount" class="lt-page">
    <main>
      <div class="wrap">
        <div class="lt-card">
			<div id="loginBox" class="card" style="margin-bottom:14px;">
  <h3 style="margin:0 0 10px;">Trader Login</h3>

  <label>Email</label>
  <input id="loginEmail" type="email" placeholder="you@example.com" />

  <label>Password</label>
  <input id="loginPassword" type="password" placeholder="Your password" />

  <button class="btn block primary" style="margin-top:12px;" onclick="traderLogin()">
    Log in
  </button>

  <div id="loginMsg" style="margin-top:10px; color:var(--muted);"></div>
</div>

         

			<div id="accountBox" style="display:none;">
 <div class="lt-badges">
            <span class="lt-badge ok">Approved ‚Äì Launching soon</span>
            <span class="lt-badge warn">Billing not started</span>
            <span class="lt-badge">Estimated launch: <strong>1 March 2026</strong></span>
          </div>
				
          <h2 class="lt-title">Trader My Account</h2>
          <p class="lt-sub">
            Your payment details are securely stored. <strong>You won‚Äôt be charged until the platform goes live to customers.</strong>
            Early adopter offer applies at launch with code <strong>EARLY50</strong>.
          </p>

          <div class="lt-grid">
            <div class="lt-row"><div class="lt-label">Plan</div><div class="lt-value">Domestic / Commercial / Both</div></div>
            <div class="lt-row"><div class="lt-label">Monthly price</div><div class="lt-value">¬£29 (single) / ¬£39 (both)</div></div>
            <div class="lt-row"><div class="lt-label">Promo code</div><div class="lt-value">EARLY50 (50% off first 3 months)</div></div>
            <div class="lt-row"><div class="lt-label">Billing starts</div><div class="lt-value">1 March 2026</div></div>
            <div class="lt-row"><div class="lt-label">Payment method</div><div class="lt-value">Saved (Card / Apple Pay / Google Pay)</div></div>
            <div class="lt-row"><div class="lt-label">Status</div><div class="lt-value">Listed at launch</div></div>
          </div>

          <div class="lt-actions">
            <button class="btn primary" onclick="return showLTPage('lt-home')">Back to Home</button>
            <button class="btn danger" onclick="alert('Cancelling stops renewal after billing starts. Subscription ends at the end of the paid period.')">
              Cancel subscription
            </button>
          </div>

          <div class="lt-note">
            Cancellation in the live version stops renewal, but the subscription ends at the end of the paid period.
     	     </div>
			</div>
        </div>
      </div>
    </main>
  </div>

  <!-- CUSTOMER TERMS -->
  <div id="lt-terms-customers" class="lt-page">
    <main>
      <div class="wrap">
        <div class="lt-card">
          <h2 class="lt-title">Customer Terms </h2>
          <p class="lt-sub">
            Local Trade Finder is a directory to help you discover and contact traders in Lancashire & Yorkshire.
            <strong>Any work agreement is between you and the trader.</strong>
          </p>

          <div class="lt-grid">
            <div class="lt-row"><div class="lt-label">Directory service</div><div class="lt-value">We list traders. We don‚Äôt provide the trade service.</div></div>
            <div class="lt-row"><div class="lt-label">No guarantee</div><div class="lt-value">We can‚Äôt guarantee availability, pricing, or outcomes.</div></div>
            <div class="lt-row"><div class="lt-label">Due diligence</div><div class="lt-value">Check qualifications/insurance where relevant.</div></div>
            <div class="lt-row"><div class="lt-label">Disputes</div><div class="lt-value">Disputes are between customer and trader.</div></div>
            <div class="lt-row"><div class="lt-label">Conduct</div><div class="lt-value">No abusive or unlawful use of the platform.</div></div>
          </div>

          <div class="lt-actions">
            <button class="btn primary" onclick="return showLTPage('lt-home')">Back to Home</button>
            <button class="btn" onclick="return showLTPage('lt-privacy')">Privacy Policy</button>
          </div>

          
        </div>
      </div>
    </main>
  </div>

  <!-- TRADER TERMS -->
  <div id="lt-terms-traders" class="lt-page">
    <main>
      <div class="wrap">
        <div class="lt-card">
          <h2 class="lt-title">Trader Terms </h2>
          <p class="lt-sub">
            Traders must provide accurate information and comply with relevant laws, safety standards, and any required certifications.
            <strong>We approve traders before listing them publicly.</strong>
          </p>

          <div class="lt-grid">
            <div class="lt-row"><div class="lt-label">Accuracy</div><div class="lt-value">Details and services must be truthful.</div></div>
            <div class="lt-row"><div class="lt-label">Insurance & compliance</div><div class="lt-value">You are responsible for insurance/certs.</div></div>
            <div class="lt-row"><div class="lt-label">Approval</div><div class="lt-value">We may request changes, approve, or decline.</div></div>
            <div class="lt-row"><div class="lt-label">Payments</div><div class="lt-value">No charge until go-live (1 March 2026).</div></div>
            <div class="lt-row"><div class="lt-label">Cancellation</div><div class="lt-value">Cancel anytime; ends at end of paid period after launch.</div></div>
            <div class="lt-row"><div class="lt-label">Removal</div><div class="lt-value">We may suspend/remove listings for breaches.</div></div>
          </div>

          <div class="lt-actions">
            <button class="btn primary" onclick="return showLTPage('lt-home')">Back to Home</button>
            <button class="btn" onclick="return showLTPage('lt-privacy')">Privacy Policy</button>
          </div>

          
        </div>
      </div>
    </main>
  </div>

  <!-- PRIVACY -->
  <div id="lt-privacy" class="lt-page">
    <main>
      <div class="wrap">
        <div class="lt-card">
          <h2 class="lt-title">Privacy Policy </h2>
          <p class="lt-sub">
            We only collect the information needed to run Local Trade Finder. We don‚Äôt sell personal data.
          </p>

          <div class="lt-grid">
            <div class="lt-row"><div class="lt-label">Trader data</div><div class="lt-value">Business details and contact info.</div></div>
            <div class="lt-row"><div class="lt-label">Customer data</div><div class="lt-value">No customer accounts in MVP.</div></div>
            <div class="lt-row"><div class="lt-label">Payments</div><div class="lt-value">Handled securely by Stripe (when enabled).</div></div>
            <div class="lt-row"><div class="lt-label">Cookies</div><div class="lt-value">Basic functionality; analytics optional later.</div></div>
            <div class="lt-row"><div class="lt-label">Contact</div><div class="lt-value">Add a support email later.</div></div>
          </div>

          <div class="lt-actions">
            <button class="btn primary" onclick="return showLTPage('lt-home')">Back to Home</button>
            <button class="btn" onclick="return showLTPage('lt-terms-customers')">Customer Terms</button>
            <button class="btn" onclick="return showLTPage('lt-terms-traders')">Trader Terms</button>
          </div>

          
        </div>
      </div>
    </main>
  </div>
<!-- Trader Profile Modal -->
<div id="profileModal" style="display:none; position:fixed; inset:0; z-index:9999;">
 <div onclick="closeProfile()" style="position:absolute; inset:0; background:rgba(0,0,0,0.82); backdrop-filter: blur(6px);"></div>

  <div style="
    position:relative;
    max-width:720px;
    margin:6vh auto;
    padding:16px;
  ">
  <div class="card" style="
  position:relative;
  background: linear-gradient(180deg, #0f1e33 0%, #14253d 100%);
  border: 2px solid rgba(94,234,212,0.7);
  box-shadow: 0 30px 90px rgba(0,0,0,0.85);
">
      <button class="btn" style="position:absolute; top:12px; right:12px;" onclick="closeProfile()">‚úï</button>

      <div id="profileContent"></div>
    </div>
  </div>
</div>
<!-- Reviews Modal -->
<div id="reviewsModal" style="display:none; position:fixed; inset:0; z-index:9999;">
  <div onclick="closeReviews()" style="position:absolute; inset:0; background:rgba(0,0,0,0.82); backdrop-filter: blur(6px);"></div>

  <div style="position:relative; max-width:720px; margin:6vh auto; padding:16px;">
    <div class="card" style="position:relative; background: linear-gradient(180deg, #0f1e33 0%, #14253d 100%);
      border: 2px solid rgba(94,234,212,0.7);
      box-shadow: 0 30px 90px rgba(0,0,0,0.85);">
      
      <button class="btn" style="position:absolute; top:12px; right:12px;" onclick="closeReviews()">‚úï</button>
      <div id="reviewsContent"></div>
    </div>
  </div>
</div>

</body>
</html>
